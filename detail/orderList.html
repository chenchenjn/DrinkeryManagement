<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
	<!-- 包含公共的JSP代码片段 -->

	<title>无线点餐平台</title>



	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript" src="style/js/jquery.js"></script>
	<script type="text/javascript" src="style/js/page_common.js"></script>
	<link href="style/css/common_style_blue.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" href="style/css/index_1.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.2.1/d3.min.js"></script>

</head>

<body>
	<!-- 页面标题 -->
	<div id="TitleArea">
		<div id="TitleArea_Head"></div>
		<div id="TitleArea_Title">
			<div id="TitleArea_Title_Content">
				<img border="0" width="13" height="13" src="style/images/title_arrow.gif" /> 餐厅订单列表
			</div>
		</div>
		<div id="TitleArea_End"></div>
	</div>

	<!-- 主内容区域（数据列表或表单显示） -->
	<div id="MainArea">
		<table class="MainArea_Content" align="center" cellspacing="0" cellpadding="0">
			<!-- 表头-->
			<thead>
				<tr align="center" valign="middle" id="TableTitle">
					<td>订单编号</td>
					<td>餐桌名</td>
					<td>下单日期</td>
					<td>总金额</td>
					<td>状态</td>
					<td>操作</td>
				</tr>
			</thead>
			<!--显示数据列表 -->
			<tbody id="TableData">

				<tr height="60">
					<td>15375222</td>
					<td>纽约</td>
					<td>2014-12-08 23:29:18.0</td>
					<td>204.0</td>


					<td>未结账&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

					</td>



					<td>
						<a href="orderDetail.html" class="FunctionButton">详细</a>

						<a href="#" class="FunctionButton">结账</a>

					</td>
				</tr>

			</tbody>
		</table>
		<!-- 其他功能超链接 -->
		<div id="TableTail" align="center">
		</div>
	</div>
</body>
<script>

	function pay(id) {
		axios.post('/orders?id=' + id)
			.then(res => {
				if (res.data.message === '结账成功') {
					// console.log(res);
					updateOrder()
				}
			})
	}

	function deleteOrder(id) {
		// console.log(id);
		// e.preventDefault();
		axios.delete('/orders?id=' + id)
			.then(res => {
				// console.log(res.data);
				const { data } = res;
				if (data.message === '删除成功') {
					updateOrder()
				}
			})
	}
	function updateOrder() {
		axios.get('/orders')
				.then(res => {
					const { data } = res;
					// for (let table of data) {
					// 	console.log(table);
					// }
					d3.select('tbody#TableData')
						.selectAll('tr')
						.data(data)
						.join('tr')
						.attr('class', 'TableDetail1')
						.html(d => `
							<td>${d['id']}&nbsp;</td>
							<td>${d['tableName']}&nbsp;</td>
							<td>${d['orderTime']}&nbsp;</td>

							<td>${d['price']}&nbsp;</td>
							<td>${d['isPay'] ? '已结账' : '未结账'}&nbsp;</td>
							<td>
								<a href="#" onClick="pay(${d['id']})" class="FunctionButton">结账</a>				

								<a href="#" onClick="deleteOrder(${d['id']})" class="FunctionButton">删除</a>				
							</td>
						`)
					console.log(data);
				})
	}
	updateOrder()
</script>
</html>