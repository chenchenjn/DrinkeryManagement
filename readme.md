# 1 项目设计部分

## 1）项目总体构成

![image-20211218203208438](../doc/image-20211218203208438.png)



## 2）引入的包在项目中的作用相关说明

前端：

axios.js主要用于向后段发起请求。

D3.js主要用来方便操作dom结构，进行渲染。

jquery.j封装javascript常用的功能代码，写更少的代码，做更多事情。

后段：

express基于node.js平台，快速，开放，极简的web开发框架。

mongoose一个让我们可以通过node来操作mongodb数据库的模块。

## 3）项目目录结构和各个部分的说明

### 1.node_modules

能够npm到的包自动统一装到这里。npm加载的项目依赖模块。

### 2.detail

放置所有的静态资源（css,js,images,html)

![image-20211218204606389](../doc/image-20211218204606389.png)

### 3.前端代码

![image-20211218204751222](../doc/image-20211218204751222.png)

### 4.主函数server.js(和test.js测试文件)

后端主程序。项目入口及程序启动文件

### 5.package.json

项目配置文件。包描述文件及开发者信息

### 6.README.md

项目说明文件



# 2 使用说明书

注意：

1.运行本地前提：要用数据库，先启动mongodb服务。别忘了联网。

```
mongod --dbpath /home/user1/mongodbData
```

```
mongo
```

2.运行老师服务器前提：

ssh进去自己的学号文件夹，node一下JS 主文件。

### 1.登录界面

邮箱：289617908@qq.com

当输入错误密码：123则显示登录失败：

![image-20211218225103794](../doc/image-20211218225103794.png)

当输入正确密码：123456则显示登录成功：

![image-20211218230119706](../doc/image-20211218230119706.png)

### 2.首页界面

登录成功后，跳转至首页:

![image-20211218212420897](../doc/image-20211218212420897.png)

### 3.餐桌管理

包含“添加”、“预定”、“删除”功能:

![image-20211218213147277](../doc/image-20211218213147277.png)

点击下方“添加”按钮，新增递增的餐桌:

![image-20211218213118970](../doc/image-20211218213118970.png)

点击右方“删除”按钮，删除相应的餐桌:

![image-20211218213501275](../doc/image-20211218213501275.png)

点击右方“预定”按钮，相应餐桌的状态显示“预约”；“预定时间”显示当前时间；“预定”按钮变为“退桌”按钮:

![image-20211218213748072](../doc/image-20211218213748072.png)

点击右方“退桌”按钮，相应餐桌数据恢复:

![image-20211218213712333](../doc/image-20211218213712333.png)

### 4.菜品管理

包含“添加”功能:

![image-20211218214425887](../doc/image-20211218214425887.png)

点击下方“添加”按钮，转至“添加新菜品“界面:

![image-20211218214627007](../doc/image-20211218214627007.png)

添加新菜品成功:

![image-20211218220154102](../doc/image-20211218220154102.png)

删除菜品成功：

![image-20211218215022211](../doc/image-20211218215022211.png)

### 5.用户点菜

包含“ + 菜品数量”、“ - 菜品数量”，以及对某桌（是否享受会员价）提交订单等功能:

![image-20211218220223107](../doc/image-20211218220223107.png)

同样的菜品，4号桌（非会员）提交订单，显示消费200元；5号桌（会员）提交订单，显示消费160元:

![image-20211218220254458](../doc/image-20211218220254458.png)

![image-20211218220323126](../doc/image-20211218220323126.png)

### 6.餐厅订单

显示已经提交的订单信息：

![image-20211218220711407](../doc/image-20211218220711407.png)

点击“结账”按钮，结账成功显示“已结账”：

![image-20211218220751650](../doc/image-20211218220751650.png)

点击“删除”按钮，删除结账成功的餐桌：

![image-20211218220919924](../doc/image-20211218220919924.png)

### 7.退出登录

主界面右上方点击“退出”按钮，返回登录界面：

![image-20211218221904036](../doc/image-20211218221904036.png)



# 3 开发日记

*<u>老师，我中间有几个阶段忘记commit了（共commot了7次），没法一一对应，所以只能大致记录下过程。</u>*

## 3.1建立仓库

选择new repository：

![image-20211218225402226](../doc/image-20211218225402226.png)

![image-20211218225554248](../doc/image-20211218225554248.png)

## 3.2建立项目（搭建express框架）

终端窗口输入：

`touch server.js `

`touch readme.md`

初始化一个简单的package.json文件,建议自定义description，keywords，author：

`npm init --save` 

此时有以下：

![image-20211218232116299](../doc/image-20211218232116299.png)

继续在终端安装express框架，使得可以发到前台：

`npm install express --save`

进入vscode测试express框架是否正常：

![image-20211218232652437](../doc/image-20211218232652437.png)

```javascript
const express = require("express")

const app =express()

app.get("/",(req,res)=>{

    res.send("hello chenchenjn")

})

app.listen(60503)
```

![image-20211218232753155](../doc/image-20211218232753155.png)

说明正常。

## 3.3编写项目(部署到老师服务器上之前,数据库叫menu)

建立并连接menu数据库：

![image-20211219000854725](../doc/image-20211219000854725.png)



#### **1.登录界面部分**

在库中建立users数据表：

Schema主要用于定义MongoDB中集合Collection里文档document的结构，model是由schema生成的模型，可以对数据库的操作。

![image-20211219004506595](../doc/image-20211219004506595.png)

注意：用户输入后，若在库里找到一样的数据，就登录成功；否则失败：

![image-20211219225636791](../doc/image-20211219225636791.png)

#### 2.系统界面部分

（系统分为以下4个模块，部分模块略写）

![image-20211219003933572](../doc/image-20211219003933572.png)

### 模块一：餐桌管理

**主列表left.html**中，

链接到boardList.html餐桌管理。



**boardList.html中**，

导入各种静态资源，使用axios实现Ajax请求，再完善下前端设计

![image-20211219000528842](../doc/image-20211219000528842.png)

在库中建立tables数据表：

![image-20211219000935444](../doc/image-20211219000935444.png)

**添加对数据库中增删改查的操作**

****server.js 和 boardList.html 相互呼应**

**在server.js**中：

1）get是请求

![image-20211219002109266](../doc/image-20211219002109266.png)



2）post是更新

![image-20211219002140282](../doc/image-20211219002140282.png)

注意：

已预约status=1 , 未预约status=0。

预约时间设计为，取当前时间的一部分，并且用 “-” 符号分隔。



3）delete是删除

![image-20211219002125255](../doc/image-20211219002125255.png)

在**boardList.html** 中：

![image-20211219002522844](../doc/image-20211219002522844.png)

### 模块二：菜品管理

在库中建立menus数据表：

![image-20211219003539491](../doc/image-20211219003539491.png)

### 模块三：用户点单

没有数据表。

注意：是否会员，要用不同的公式计算金额。会员价=原价*0.8。

![image-20211219004143967](../doc/image-20211219004143967.png)

### 模块四：餐厅订单

在库中建立orders数据表：

![image-20211219003649165](../doc/image-20211219003649165.png)

## 3.4 对users表添加新用户，尝试登录

`show dbs`查询数据库

`show collectiions` 查询表

`use 表` 进入某表

查看menu数据库中的表，可见users表存在：

![image-20211219010036150](../doc/image-20211219010036150.png)

![image-20211219010051286](../doc/image-20211219010051286.png)



查询users表发现为空，

然后插入我的邮箱和密码，再查询，此时可以查询到一条新增的用户信息：

![image-20211219005704697](../doc/image-20211219005704697.png)

使用此用户去登录，登录成功！



## 3.5 部署到老师的服务器上（此时数据库叫190110910503）

连接校园网,连接老师的mongodb：

![image-20211219232240106](../doc/image-20211219232240106.png)

复制mongodb://172.21.2.236:27017粘贴到vscode里面，建立新的连接，数据库名用自己学号：

```
mongoose.connect('mongodb://172.21.2.236:27017/190110910503');
```

![image-20211219232408306](../doc/image-20211219232408306.png)

执行，刷新，看到了自己的数据库（我的4张表也加进去了）：

![image-20211219232421407](../doc/image-20211219232421407.png)

此时本地（自己的地址+端口号）还可以访问：

![image-20211219232705299](../doc/image-20211219232705299.png)



先关闭vscode防止占用。开始把自己的数据库复制给老师。在文件的上级目录进终端：

一定要用osuser进去，如果不是：`ssh osuser@172.21.2.236`

ls查看所有，此时我的学号数据库已经（在课上）加进去了：

（若没有，需要用自己的学号创建目录 `mkdir 190110910503`)

![image-20211219233041159](../doc/image-20211219233041159.png)

exit退出之后

scp -r DrinkeryManagement/ osuser@172.21.2.236:~/190110910503

![image-20211220014102750](../doc/image-20211220014102750.png)

再进去ssh osuser@172.21.2.236。

发现文件夹DrinkeryManagement已经在了。

进去文件夹DrinkeryManagement    再ls，发现里面东西在的。

node主JS文件：

![image-20211220014150374](../doc/image-20211220014150374.png)

此时老师的（老师的地址+端口号）可以访问：

![image-20211220014444303](../doc/image-20211220014444303.png)

但此时老师的数据库里，我的数据还没有添加进去。所以进入老师的mongodb：

（之前已经进了的话就接着写）

![image-20211220030202872](../doc/image-20211220030202872.png)

看看老师的mongo里面：`show dbs`

![image-20211220030410370](../doc/image-20211220030410370.png)

![image-20211220030354260](../doc/image-20211220030354260.png)

往我的学号数据库中的users表中添加用户（注意字段类型都是string）：

```
db.users.insert({id:0,email:"289617908@qq.com","password":"123456"})
```

![image-20211220030459383](../doc/image-20211220030459383.png)

此时用该用户去登录，成功：

![image-20211220030723006](../doc/image-20211220030723006.png)

部署完毕。此时后台还不能运行。

## 3.6 nohup后台运行

![image-20211222191403293](../doc/image-20211222191403293.png)

exit退出后，后台能继续运行。

端口号：172.21.2.236:50503

账号：289617908@qq.com

密码：123456



## 3.7 commit到本地仓库和push到远程仓库

## 先commit到本地仓库：

框内输入commit的标题，回车：

![image-20211222201037932](../doc/image-20211222201037932.png)

## 后push到远程仓库：

为了push，给仓库建立一个master分支，去push到master分支:

密码要用token(过期了要换一个):

```
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
```

![image-20211219011929223](../doc/image-20211219011929223.png)

从guthub里面选好远程仓库，然后推送到：

![image-20211222201315900](../doc/image-20211222201315900.png)

![image-20211222201143405](../doc/image-20211222201143405.png)

此时已经push到该远程仓库的master分支了：

![image-20211222201459694](../doc/image-20211222201459694.png)
